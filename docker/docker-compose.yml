# Copyright (c) 2025-2026 BlackRoad OS, Inc. All Rights Reserved.
# Build each service from its own repo with: docker compose build <service>

services:
  core:
    build:
      context: ./core
      dockerfile: Dockerfile
    ports:
      - "8787:8787"
    environment:
      - NODE_ENV=production
      - BLACKROAD_GATEWAY_PORT=8787
    networks:
      - blackroad
    restart: unless-stopped

  web:
    build:
      context: ./web
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_GATEWAY_URL=http://core:8787
    depends_on:
      - core
    networks:
      - blackroad
    restart: unless-stopped

  agents:
    build:
      context: ./agents
      dockerfile: Dockerfile
    ports:
      - "8788:8788"
    environment:
      - NODE_ENV=production
      - GATEWAY_URL=http://core:8787
    depends_on:
      - core
    networks:
      - blackroad
    restart: unless-stopped

  operator:
    build:
      context: ./operator
      dockerfile: Dockerfile
    environment:
      - BLACKROAD_GATEWAY_URL=http://core:8787
    depends_on:
      - core
    networks:
      - blackroad
    profiles:
      - tools

networks:
  blackroad:
    driver: bridge
